<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CueUp - Debug Tools</title>
    <link rel="stylesheet" href="startpage.css">
    <script src="modern-auth.js"></script>
    
    <!-- Favicon Integration - Firefox-optimiert -->
    <!-- Standard ICO f√ºr alle Browser (Firefox bevorzugt) -->
    <link rel="icon" href="favicon_io/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="favicon_io/favicon.ico" type="image/x-icon">
    
    <!-- PNG Favicons f√ºr moderne Browser -->
    <link rel="icon" type="image/png" sizes="16x16" href="favicon_io/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon_io/favicon-32x32.png">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="favicon_io/apple-touch-icon.png">
    
    <!-- Web App Manifest -->
    <link rel="manifest" href="favicon_io/site.webmanifest">
    
    <!-- Browser-spezifische Meta-Tags -->
    <meta name="msapplication-TileColor" content="#aa00ff">
    <meta name="theme-color" content="#aa00ff">
    
    <!-- Firefox-spezifischer Fallback -->
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <style>
        body {
            color: #fff;
        }
        
        .debug-container {
            max-width: 900px;
            margin: 30px auto;
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.6);
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .debug-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .debug-header h1 {
            color: #aa00ff;
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .debug-section {
            margin-bottom: 30px;
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.4);
            border-radius: 8px;
            border-left: 4px solid #aa00ff;
        }
        
        .debug-section h2 {
            color: #aa00ff;
            margin-top: 0;
        }
        
        .test-button {
            background: linear-gradient(135deg, #aa00ff, #cc44ff);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }
        
        .test-button:hover {
            background: linear-gradient(135deg, #cc44ff, #aa00ff);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(170, 0, 255, 0.4);
        }
        
        .result-container {
            background-color: #1e1e1e;
            border: 1px solid #333;
            border-radius: 5px;
            padding: 15px;
            margin-top: 15px;
            overflow-x: auto;
            max-height: 400px;
            font-family: monospace;
            white-space: pre-wrap;
            color: #ddd;
        }
        
        .success {
            color: #4caf50;
            border-left: 4px solid #4caf50;
        }
        
        .error {
            color: #f44336;
            border-left: 4px solid #f44336;
        }
        
        .warning {
            color: #ff9800;
            border-left: 4px solid #ff9800;
        }
        
        .status-details {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .status-details p {
            margin: 8px 0;
            color: #ddd;
        }
        
        .spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, .3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
            vertical-align: middle;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .traffic-light {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 15px;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }
        
        .traffic-light.green {
            background-color: #4caf50;
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.6);
        }
        
        .traffic-light.yellow {
            background-color: #ff9800;
            box-shadow: 0 0 15px rgba(255, 152, 0, 0.6);
        }
        
        .traffic-light.red {
            background-color: #f44336;
            box-shadow: 0 0 15px rgba(244, 67, 54, 0.6);
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
        }
        
        .quick-tests {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 10px 0;
        }
        
        .quick-test {
            background: linear-gradient(135deg, #2196F3, #21CBF3);
            font-size: 0.9rem;
            padding: 8px 16px;
        }
        
        .quick-test:hover {
            background: linear-gradient(135deg, #21CBF3, #2196F3);
        }
        
        /* Footer Styles */
        .footer {
            background: #222;
            padding: 3rem 2rem 1rem;
            margin-top: 4rem;
        }
        
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }
        
        .footer-section h3 {
            color: #aa00ff;
            margin-bottom: 1rem;
        }
        
        .footer-section p, .footer-section a {
            color: #ccc;
            line-height: 1.6;
        }
        
        .footer-links {
            list-style: none;
            padding: 0;
        }
        
        .footer-links li {
            margin-bottom: 10px;
        }
        
        .footer-links a {
            color: #ccc;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .footer-links a:hover {
            color: #aa00ff;
        }
        
        .footer-bottom {
            text-align: center;
            padding-top: 2rem;
            margin-top: 2rem;
            border-top: 1px solid #333;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .footer-bottom p {
            color: #888;
            margin: 0;
        }
        
        .footer-bottom a {
            color: #aa00ff;
            text-decoration: none;
        }
        
        .footer-bottom a:hover {
            text-decoration: underline;
        }
        
        .problem-section {
            background-color: rgba(255, 152, 0, 0.05);
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 3px solid #ff9800;
        }
        
        .problem-section h3 {
            color: #ff9800;
            margin-top: 0;
        }
        
        .contact-link {
            color: #aa00ff;
            text-decoration: none;
            font-weight: bold;
        }
        
        .contact-link:hover {
            color: #cc44ff;
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <header>
        <a href="startpage" class="mainLogoLink">
            <h1 class="mainlogo">Cueup</h1>
        </a>
        <div style="display: flex; align-items: center; margin-right: 20px;">
            <label class="burger" for="burger">
                <input type="checkbox" id="burger" />
                <span></span>
                <span></span>
                <span></span>
            </label>
        </div>
    </header>

    <div class="sidebar" id="sidebar">
        <nav>
            <ul id="navigationMenu">
                <li><a href="startpage">Startseite</a></li>
                <li><a href="free">Login</a></li>
                <li><a href="contact">Kontakt</a></li>
            </ul>
        </nav>
    </div>

    <main>
        <div class="debug-container">
            <div class="debug-header">
                <h1>CueUp Server Status</h1>
                <p>√úberpr√ºfen Sie den aktuellen Status des CueUp Servers</p>
            </div>

            <div class="debug-section">
                <h2>üîó Server-Verbindung</h2>
                <div id="statusDetails" class="status-details">
                    <div class="status-indicator">
                        <div id="statusLight" class="traffic-light yellow"></div>
                        <div class="status-text">
                            <p><strong>Status:</strong> <span id="statusText">Wird gepr√ºft...</span></p>
                            <p id="responseTime"><strong>Antwortzeit:</strong> --</p>
                            <p id="lastCheck"><strong>Letzte Pr√ºfung:</strong> --</p>
                        </div>
                    </div>
                </div>
                <button id="checkConnection" class="test-button">
                    Status aktualisieren
                    <span id="connectionSpinner" class="spinner"></span>
                </button>
            </div>

            <div class="debug-section" id="problemSection" style="display: none;">
                <h2>‚ö†Ô∏è Probleme erkannt</h2>
                <div class="problem-section">
                    <h3>Server nicht erreichbar</h3>
                    <p><strong>M√∂gliche Ursachen:</strong></p>
                    <ul>
                        <li>üîß Server ist gerade offline oder wird gewartet</li>
                        <li>üåê Ihre Internetverbindung ist unterbrochen</li>
                        <li>üìß Bei dauerhaften Problemen: <a href="contact" class="contact-link">Kontakt</a></li>
                    </ul>
                </div>
                <div class="problem-section" id="slowServerWarning" style="display: none;">
                    <h3>Langsame Serverantwort</h3>
                    <p><strong>M√∂gliche Ursachen:</strong></p>
                    <ul>
                        <li>‚è≥ Server ist √ºberlastet</li>
                        <li>üåê Ihre Internetverbindung ist langsam</li>
                        <li>üìß Bei dauerhaften Problemen: <a href="contact" class="contact-link">Kontakt</a></li>
                    </ul>
                </div>
            </div>

            <div class="debug-section">
                <h2>üîß Server-Tests</h2>
                <div class="quick-tests">
                    <button class="test-button quick-test" data-url="https://cueup-project.onrender.com/auth/status">Server Status</button>
                    <button class="test-button quick-test" data-url="https://cueup-project.onrender.com/api/events" data-auth="true">API Events*</button>
                    <button class="test-button quick-test" data-url="https://cueup-project.onrender.com/spotify/me" data-auth="true">Spotify User*</button>
                    <button class="test-button" id="testAllEndpoints">Alle Endpunkte testen (3)</button>
                </div>
                <div class="problem-section" style="background-color: rgba(33, 150, 243, 0.1); border-left: 3px solid #2196F3;">
                    <h3 style="color: #2196F3; margin-top: 0;">‚ÑπÔ∏è Wichtiger Hinweis</h3>
                    <p><strong>API Events</strong> und <strong>Spotify User</strong> Tests funktionieren nur, wenn Sie:</p>
                    <ul>
                        <li>üîê Bei CueUp √ºber Spotify <strong>angemeldet</strong> sind</li>
                        <li>üéµ Eine aktive <strong>Spotify-Session</strong> haben</li>
                        <li>‚úÖ √úber <a href="free" class="contact-link">Login-Seite</a> eingeloggt sind</li>
                    </ul>
                    <p style="color: #ccc; font-size: 0.9rem; margin-bottom: 0;">
                        * Ohne Anmeldung zeigen diese Tests "401/403 Fehler" - das ist normal!
                    </p>
                </div>
                <div id="testResults" class="result-container" style="display: none;"></div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>CueUp</h3>
                <p>Die professionelle L√∂sung f√ºr DJ Event-Management und Musikwunsch-Verwaltung mit nahtloser Spotify-Integration.</p>
            </div>
            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul class="footer-links">
                    <li><a href="startpage">Startseite</a></li>
                    <li><a href="createevent">Event erstellen</a></li>
                    <li><a href="myEvents">Meine Events</a></li>
                    <li><a href="contact">Kontakt</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>CueUp | <a href="debug" style="color: #888; text-decoration: none;">Debug Tools</a></p>
        </div>
    </footer>

    <script>
        // Burger Menu Toggle
        document.addEventListener('DOMContentLoaded', function() {
            const burger = document.getElementById('burger');
            const sidebar = document.getElementById('sidebar');
            if (burger && sidebar) {
                burger.addEventListener('change', function() {
                    sidebar.classList.toggle('active');
                });
            }
        });

        // Standard-Men√º anzeigen
        function showDefaultMenu() {
            const navigationMenu = document.getElementById('navigationMenu');
            navigationMenu.innerHTML = `
                <li><a href="startpage">Startseite</a></li>
                <li><a href="contact">Kontakt</a></li>
                <li><a href="debug">Debug</a></li>
                <li><a href="free">Einloggen</a></li>
            `;
        }

        // Dynamisches Men√º basierend auf Login-Status
        async function updateNavigation() {
            const navigationMenu = document.getElementById('navigationMenu');
            
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 3000);
                
                const response = await fetch('https://cueup-project.onrender.com/auth/status', {
                    credentials: 'include',
                    signal: controller.signal
                }).catch(err => {
                    if (err.name === 'AbortError') {
                        console.log('Auth check timeout - zeige Gast-Men√º');
                    }
                    throw err;
                });
                
                clearTimeout(timeoutId);
                
                if (!response) return;
                
                const data = await response.json();
                const isLoggedIn = data.isAuthenticated;
                
                let menuItems = [];
                
                if (isLoggedIn) {
                    menuItems = [
                        { text: 'Startseite', href: 'startpage' },
                        { text: 'Event erstellen', href: 'createevent' },
                        { text: 'Meine Events', href: 'myEvents' },
                        { text: 'Kontakt', href: 'contact' },
                        { text: 'Debug', href: 'debug' },
                        { text: 'Ausloggen', href: '#', onclick: 'auth.logout()' }
                    ];
                } else {
                    menuItems = [
                        { text: 'Startseite', href: 'startpage' },
                        { text: 'Kontakt', href: 'contact' },
                        { text: 'Debug', href: 'debug' },
                        { text: 'Einloggen', href: 'free' }
                    ];
                }
                
                navigationMenu.innerHTML = menuItems.map(item => {
                    if (item.onclick) {
                        return `<li><a href="${item.href}" onclick="${item.onclick}">${item.text}</a></li>`;
                    } else {
                        return `<li><a href="${item.href}">${item.text}</a></li>`;
                    }
                }).join('');
                
            } catch (error) {
                console.log('Auth check failed, showing guest menu');
                navigationMenu.innerHTML = `
                    <li><a href="startpage">Startseite</a></li>
                    <li><a href="contact">Kontakt</a></li>
                    <li><a href="debug">Debug</a></li>
                    <li><a href="free">Einloggen</a></li>
                `;
            }
        }

        // Backend-Verbindungsstatus pr√ºfen
        document.getElementById('checkConnection').addEventListener('click', async function() {
            const spinner = document.getElementById('connectionSpinner');
            const responseTimeElement = document.getElementById('responseTime');
            const lastCheckElement = document.getElementById('lastCheck');
            const problemSection = document.getElementById('problemSection');
            
            spinner.style.display = 'inline-block';
            
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 8000);
                
                const startTime = performance.now();
                const response = await fetch('https://cueup-project.onrender.com/auth/status', {
                    method: 'GET',
                    credentials: 'include',
                    signal: controller.signal
                });
                const endTime = performance.now();
                const latency = Math.round(endTime - startTime);
                
                clearTimeout(timeoutId);
                
                // Erfolgreiche Verbindung
                responseTimeElement.innerHTML = `<strong>Antwortzeit:</strong> ${latency}ms`;
                lastCheckElement.innerHTML = `<strong>Letzte Pr√ºfung:</strong> ${new Date().toLocaleTimeString('de-DE')}`;
                
                // Ampel auf Gr√ºn
                document.getElementById('statusLight').className = 'traffic-light green';
                document.getElementById('statusText').textContent = 'Online';
                problemSection.style.display = 'none';
                
                // Warnung bei langsamer Antwortzeit
                if (latency > 2000) {
                    document.getElementById('statusLight').className = 'traffic-light yellow';
                    document.getElementById('statusText').textContent = 'Langsam';
                    if (latency > 5000) {
                        problemSection.style.display = 'block';
                        document.getElementById('slowServerWarning').style.display = 'block';
                    }
                }
                
            } catch (error) {
                responseTimeElement.innerHTML = '<strong>Antwortzeit:</strong> Timeout';
                lastCheckElement.innerHTML = `<strong>Letzte Pr√ºfung:</strong> ${new Date().toLocaleTimeString('de-DE')}`;
                
                // Ampel auf Rot
                document.getElementById('statusLight').className = 'traffic-light red';
                document.getElementById('statusText').textContent = 'Offline';
                problemSection.style.display = 'block';
                
            } finally {
                spinner.style.display = 'none';
            }
        });
        
        // Server-Tests
        document.addEventListener('DOMContentLoaded', function() {
            // Quick Tests f√ºr einzelne Endpunkte
            document.querySelectorAll('.quick-test').forEach(button => {
                button.addEventListener('click', async function() {
                    const url = this.getAttribute('data-url');
                    const resultContainer = document.getElementById('testResults');
                    
                    resultContainer.style.display = 'block';
                    resultContainer.innerHTML = `üîÑ Teste ${url}...\n`;
                    
                    try {
                        const startTime = performance.now();
                        const controller = new AbortController();
                        const timeoutId = setTimeout(() => controller.abort(), 8000);
                        
                        const response = await fetch(url, {
                            credentials: 'include',
                            method: 'GET',
                            signal: controller.signal,
                            headers: {
                                'Accept': 'application/json'
                            }
                        });
                        
                        clearTimeout(timeoutId);
                        const endTime = performance.now();
                        const responseTime = Math.round(endTime - startTime);
                        
                        let result;
                        let statusClass;
                        
                        if (response.ok) {
                            statusClass = 'success';
                            result = `‚úÖ Status: ${response.status} ${response.statusText}\n`;
                            result += `‚è±Ô∏è Antwortzeit: ${responseTime}ms\n`;
                            result += `üåê URL: ${url}\n\n`;
                            
                            try {
                                const data = await response.json();
                                result += `üìã Response:\n${JSON.stringify(data, null, 2)}`;
                            } catch (e) {
                                result += `üìã Response: Text-Response oder Parse-Fehler`;
                            }
                        } else if (response.status === 401 || response.status === 403) {
                            statusClass = 'warning';
                            result = `‚ö†Ô∏è Status: ${response.status} ${response.statusText}\n`;
                            result += `‚è±Ô∏è Antwortzeit: ${responseTime}ms\n`;
                            result += `üåê URL: ${url}\n\n`;
                            result += `üîí Endpunkt erfordert Spotify-Anmeldung\n`;
                            result += `‚ÑπÔ∏è Dies ist normal - melden Sie sich zuerst bei Spotify an`;
                        } else {
                            statusClass = 'error';
                            result = `‚ùå Status: ${response.status} ${response.statusText}\n`;
                            result += `‚è±Ô∏è Antwortzeit: ${responseTime}ms\n`;
                            result += `üåê URL: ${url}\n\n`;
                            result += `‚ùå Server-Fehler oder Endpunkt nicht gefunden`;
                        }
                        
                        resultContainer.className = `result-container ${statusClass}`;
                        
                        resultContainer.innerHTML = result;
                        
                    } catch (error) {
                        resultContainer.className = 'result-container error';
                        if (error.name === 'AbortError') {
                            resultContainer.innerHTML = `‚ùå Timeout beim Testen von:\n${url}\n\n‚è∞ Anfrage dauerte l√§nger als 8 Sekunden`;
                        } else {
                            resultContainer.innerHTML = `‚ùå Fehler beim Testen von:\n${url}\n\nüîó Fehlermeldung: ${error.message}`;
                        }
                    }
                });
            });
        });
        
        // Funktion zum Testen aller Endpunkte
        async function testAllEndpoints() {
            const resultContainer = document.getElementById('testResults');
            resultContainer.style.display = 'block';
            resultContainer.className = 'result-container';
            resultContainer.innerHTML = 'üîÑ Teste alle Server-Endpunkte...\n\n';
            
            const endpoints = [
                { url: 'https://cueup-project.onrender.com/auth/status', name: 'Server Status' },
                { url: 'https://cueup-project.onrender.com/api/events', name: 'API Events (Anmeldung erforderlich)' },
                { url: 'https://cueup-project.onrender.com/spotify/me', name: 'Spotify User (Anmeldung erforderlich)' }
            ];
            
            let allResults = '';
            let successCount = 0;
            
                for (const endpoint of endpoints) {
                try {
                    const startTime = performance.now();
                    const response = await fetch(endpoint.url, {
                        credentials: 'include',
                        method: 'GET',
                        signal: AbortSignal.timeout(8000)
                    });
                    const endTime = performance.now();
                    const responseTime = Math.round(endTime - startTime);
                    
                    let status, description;
                    if (response.ok) {
                        status = '‚úÖ';
                        successCount++;
                        description = `${response.status}`;
                    } else if (response.status === 401 || response.status === 403) {
                        status = '‚ö†Ô∏è';
                        description = `${response.status} (Anmeldung erforderlich)`;
                        // Z√§hlen als teilweiser Erfolg, da der Server antwortet
                        successCount += 0.5;
                    } else {
                        status = '‚ùå';
                        description = `${response.status}`;
                    }
                    
                    allResults += `${status} ${endpoint.name}: ${description} (${responseTime}ms)\n`;
                } catch (error) {
                    allResults += `‚ùå ${endpoint.name}: ${error.name === 'TimeoutError' ? 'Timeout' : 'Fehler'}\n`;
                }
            }            const maxScore = endpoints.length;
            const summary = `üìä Ergebnis: ${successCount.toFixed(1)}/${maxScore} Endpunkte funktionieren\n\n`;
            resultContainer.innerHTML = summary + allResults + '\nüèÅ Test aller Endpunkte abgeschlossen!';
            
            // CSS-Klasse je nach Erfolg setzen
            if (successCount >= maxScore * 0.9) {
                resultContainer.className = 'result-container success';
            } else if (successCount >= maxScore * 0.5) {
                resultContainer.className = 'result-container warning';
            } else {
                resultContainer.className = 'result-container error';
            }
        }

        // Event Listener f√ºr "Alle Endpunkte testen" Button
        document.addEventListener('DOMContentLoaded', function() {
            const testAllButton = document.getElementById('testAllEndpoints');
            if (testAllButton) {
                testAllButton.addEventListener('click', testAllEndpoints);
            }
        });

        // Automatischer Check beim Laden der Seite
        window.addEventListener('DOMContentLoaded', function() {
            // Sofort Standard-Men√º anzeigen
            showDefaultMenu();
            
            // Navigation aktualisieren
            setTimeout(updateNavigation, 100);
            
            // Verbindung pr√ºfen (mit Verz√∂gerung, damit Element geladen ist)
            setTimeout(() => {
                const checkButton = document.getElementById('checkConnection');
                if (checkButton) {
                    checkButton.click();
                }
            }, 500);
            
            // Auto-Refresh alle 60 Sekunden
            setInterval(function() {
                const checkButton = document.getElementById('checkConnection');
                if (checkButton) {
                    checkButton.click();
                }
            }, 60000);
        });
    </script>
</body>
</html>



