<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CueUp System Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #222;
            color: #fff;
        }
        .test-section {
            background: #333;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background: #2d5a27; color: #90ee90; }
        .error { background: #5a2d2d; color: #ff9090; }
        .info { background: #2d4a5a; color: #90d0ee; }
        button {
            background: #1db954;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1ed760;
        }
        #navigation {
            background: #444;
            padding: 10px;
            border-radius: 4px;
        }
        #navigation ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            gap: 20px;
        }
        #navigation a {
            color: #fff;
            text-decoration: none;
            padding: 8px 12px;
            border-radius: 4px;
            background: #555;
        }
        #navigation a:hover {
            background: #666;
        }
    </style>
</head>
<body>
    <h1>üîß CueUp System Test</h1>
    
    <div class="test-section">
        <h2>1. Skript-Loading Test</h2>
        <div id="script-test" class="test-result info">Teste Scripts...</div>
    </div>
    
    <div class="test-section">
        <h2>2. Auth-System Test</h2>
        <div id="auth-test" class="test-result info">Teste Auth-System...</div>
        <div id="auth-details"></div>
    </div>
    
    <div class="test-section">
        <h2>3. Navigation Test</h2>
        <div id="navigation">
            <ul id="navigationMenu">
                <li><a href="#">Loading...</a></li>
            </ul>
        </div>
        <div id="nav-test" class="test-result info">Navigation wird geladen...</div>
    </div>
    
    <div class="test-section">
        <h2>4. Funktions-Tests</h2>
        <button onclick="testSpotifyLogin()">Test Spotify Login</button>
        <button onclick="testLogout()">Test Logout</button>
        <button onclick="testPageProtection()">Test Page Protection</button>
        <div id="function-test" class="test-result info">Bereit f√ºr Tests...</div>
    </div>
    
    <div class="test-section">
        <h2>5. Server-Verbindung Test</h2>
        <button onclick="testServerConnection()">Test Server</button>
        <div id="server-test" class="test-result info">Bereit f√ºr Server-Test...</div>
    </div>

    <!-- Load our scripts -->
    <script src="config.js"></script>
    <script src="modern-auth.js"></script>
    
    <script>
        function log(elementId, message, type) {
            var element = document.getElementById(elementId);
            element.className = 'test-result ' + type;
            element.innerHTML = message;
        }
        
        function logAppend(elementId, message) {
            var element = document.getElementById(elementId);
            element.innerHTML += '<br>' + message;
        }
        
        // Test 1: Script Loading
        setTimeout(function() {
            var configLoaded = typeof CONFIG !== 'undefined';
            var authLoaded = typeof ModernAuth !== 'undefined';
            var authInstance = typeof window.auth !== 'undefined';
            
            if (configLoaded && authLoaded && authInstance) {
                log('script-test', '‚úÖ Alle Scripts erfolgreich geladen', 'success');
                logAppend('script-test', 'CONFIG: ' + (configLoaded ? '‚úÖ' : '‚ùå'));
                logAppend('script-test', 'ModernAuth: ' + (authLoaded ? '‚úÖ' : '‚ùå'));
                logAppend('script-test', 'window.auth: ' + (authInstance ? '‚úÖ' : '‚ùå'));
            } else {
                log('script-test', '‚ùå Script-Loading fehlgeschlagen', 'error');
                logAppend('script-test', 'CONFIG: ' + (configLoaded ? '‚úÖ' : '‚ùå'));
                logAppend('script-test', 'ModernAuth: ' + (authLoaded ? '‚úÖ' : '‚ùå'));
                logAppend('script-test', 'window.auth: ' + (authInstance ? '‚úÖ' : '‚ùå'));
            }
        }, 500);
        
        // Test 2: Auth System
        setTimeout(function() {
            if (window.auth) {
                log('auth-test', '‚úÖ Auth-System funktionsf√§hig', 'success');
                document.getElementById('auth-details').innerHTML = 
                    '<strong>Status:</strong> ' + (window.auth.isAuthenticated ? 'Angemeldet' : 'Nicht angemeldet') + '<br>' +
                    '<strong>User:</strong> ' + (window.auth.user ? JSON.stringify(window.auth.user) : 'Kein User') + '<br>' +
                    '<strong>Session Key:</strong> ' + window.auth.sessionKey;
            } else {
                log('auth-test', '‚ùå Auth-System nicht verf√ºgbar', 'error');
            }
        }, 1000);
        
        // Test 3: Navigation
        setTimeout(function() {
            var navMenu = document.getElementById('navigationMenu');
            if (navMenu && navMenu.innerHTML.indexOf('Loading...') === -1) {
                log('nav-test', '‚úÖ Navigation erfolgreich geladen', 'success');
            } else {
                log('nav-test', '‚ùå Navigation nicht geladen', 'error');
            }
        }, 1500);
        
        // Function Tests
        function testSpotifyLogin() {
            try {
                if (window.auth && window.auth.spotifyLogin) {
                    log('function-test', '‚úÖ Spotify Login verf√ºgbar - w√ºrde zu: ' + (window.ENDPOINTS ? window.ENDPOINTS.LOGIN : 'Default URL'), 'success');
                    // Don't actually redirect during test
                    // window.auth.spotifyLogin();
                } else {
                    log('function-test', '‚ùå Spotify Login nicht verf√ºgbar', 'error');
                }
            } catch (error) {
                log('function-test', '‚ùå Spotify Login Fehler: ' + error.message, 'error');
            }
        }
        
        function testLogout() {
            try {
                if (window.auth && window.auth.logout) {
                    log('function-test', '‚úÖ Logout-Funktion verf√ºgbar', 'success');
                    // Don't actually logout during test
                    // window.auth.logout();
                } else {
                    log('function-test', '‚ùå Logout-Funktion nicht verf√ºgbar', 'error');
                }
            } catch (error) {
                log('function-test', '‚ùå Logout Fehler: ' + error.message, 'error');
            }
        }
        
        function testPageProtection() {
            try {
                if (window.auth && window.auth.protectPage) {
                    var result = window.auth.protectPage();
                    log('function-test', '‚úÖ Page Protection: ' + (result ? 'Zugriff gew√§hrt' : 'Weiterleitung w√ºrde erfolgen'), 'success');
                } else {
                    log('function-test', '‚ùå Page Protection nicht verf√ºgbar', 'error');
                }
            } catch (error) {
                log('function-test', '‚ùå Page Protection Fehler: ' + error.message, 'error');
            }
        }
        
        function testServerConnection() {
            if (!window.CONFIG || !window.CONFIG.BACKEND_URL) {
                log('server-test', '‚ùå Keine Backend-URL konfiguriert', 'error');
                return;
            }
            
            log('server-test', 'Teste Verbindung zu: ' + window.CONFIG.BACKEND_URL, 'info');
            
            var xhr = new XMLHttpRequest();
            xhr.timeout = 5000;
            
            xhr.onload = function() {
                if (xhr.status === 200) {
                    log('server-test', '‚úÖ Server erreichbar (Status: ' + xhr.status + ')', 'success');
                } else {
                    log('server-test', '‚ö†Ô∏è Server antwortet (Status: ' + xhr.status + ')', 'info');
                }
            };
            
            xhr.onerror = function() {
                log('server-test', '‚ùå Server nicht erreichbar', 'error');
            };
            
            xhr.ontimeout = function() {
                log('server-test', '‚ùå Server-Timeout nach 5s', 'error');
            };
            
            xhr.open('GET', window.CONFIG.BACKEND_URL + '/auth/status', true);
            xhr.withCredentials = true;
            xhr.send();
        }
        
        // Auto-run server test
        setTimeout(testServerConnection, 2000);
    </script>
</body>
</html>